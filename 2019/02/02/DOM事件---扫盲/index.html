<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>DOM事件---扫盲 | kungfufu</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">DOM事件---扫盲</h1><a id="logo" href="/.">kungfufu</a><p class="description">kungfufu的博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">DOM事件---扫盲</h1><div class="post-meta">Feb 2, 2019</div><div class="post-content"><h3 id="DOM事件"><a href="#DOM事件" class="headerlink" title="DOM事件"></a>DOM事件</h3><p>事件就是浏览器的一种通知，主要要了解这么些东西：</p>
<ul>
<li>事件类型：键盘（keydown，keyup，keypress），鼠标（mousedown，mousemove，click），触屏（touchstart，touchmove，touchend），表单（submit，click，focus），拖拽，文档加载事件。  </li>
<li>事件对象：触发事件时生成的event对象，包含许多相关属性，如event.target，event.currentTarget，event.keyCode，event.type.</li>
<li>事件流传播：向上冒泡，向下捕获，DOM2级事件的三个阶段。</li>
<li>事件取消：取消事件关联的默认操作，如a标签的重定向</li>
<li>事件注册：三种注册方式，DOM0,DOM2,html属性注册</li>
<li>事件处理程序中的this指向</li>
</ul>
<h3 id="事件流"><a href="#事件流" class="headerlink" title="事件流"></a>事件流</h3><p>我们都知道“向上冒泡，向下捕获”，这其实是2种事件流的传播方式，是因为IE和NetScape两家公司对事件流的不同实现，为什么会出现两种截然相反的事件流实现呢？我见过比较通俗易懂的解释就是“类比同心圆法”，假设一张白纸上有多个同心圆，我们手指放在圆心上，那么我们指向的是多个圆。</p>
<h3 id="事件捕获"><a href="#事件捕获" class="headerlink" title="事件捕获"></a>事件捕获</h3><blockquote>
<p>当窗口监听到事件发生时，先从离事件源最远的父元素开始通知，比如window最先获得事件通知，然后是document，然后是document.documentElement,接着是body，一级一级往下传播。<br><strong>document.documentElement是获取文档的根元素，如HTML文档的html元素</strong></p>
</blockquote>
<h3 id="事件冒泡"><a href="#事件冒泡" class="headerlink" title="事件冒泡"></a>事件冒泡</h3><blockquote>
<p>事件先从事件源的元素通知，然后逐级向上级父元素通知，与捕获相反，最后通知到window对象。大部分事件都会冒泡，但是也有例外，focus，blur，scroll就不冒泡。</p>
</blockquote>
<h3 id="DOM2级事件"><a href="#DOM2级事件" class="headerlink" title="DOM2级事件"></a>DOM2级事件</h3><blockquote>
<p>由于事件流机制的不统一，开发过程会带来额外的麻烦。ECMAScript在DOM2中统一了事件流标准，基本是以上两者的结合，事件先从window对象向下捕获，然后到达事件源的元素，再向上冒泡回window对象。<br>DOM2事件有3个阶段，按照事件流通知顺序分别是：<strong>捕获阶段—&gt;目标阶段—–&gt;冒泡阶段</strong>。<br>图片来自：<a href="https://www.w3.org/TR/DOM-Level-3-Events/#event-flow" target="_blank" rel="noopener">链接</a><br><img src="https://coding.net/u/home-fyy/p/blog_images/git/raw/master/code_images/event_stream.png" width="400" height="400" title="event-stream"></p>
</blockquote>
<h3 id="事件注册"><a href="#事件注册" class="headerlink" title="事件注册"></a>事件注册</h3><p>3种事件注册方式</p>
<ul>
<li><p><strong>设置HTML属性注册</strong><br>直接在html元素上设置事件处理程序，但是不能包含函数声明，只能是调用函数，或者是代码块。当为代码块形式调用时，this指向当前元素，与event.currentTarget相同。当this是在处理程序的内部开始的指向时，它指向全局对象Window</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"console.log(this.type)"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span>  // this指向button元素</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">"myLog()"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">myLog</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)  <span class="comment">// this指向Window对象</span></span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>设置对象属性（DOM0级事件系统）</strong><br>事件处理程序中this指向当前处理事件的元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    event = event || <span class="built_in">window</span>.event;  <span class="comment">//兼容IE8及以下版本</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)；  <span class="comment">//指向id为btn的元素</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>addEventListener(): (DOM2级事件系统)</strong><br>用该函数添加事件处理程序，可以为同一个事件添加多个处理函数，（同一个事件流模式下）他们会按添加顺序分别执行，<strong>注意第3个参数：false（指定事件为冒泡模式，在冒泡到达时生效）;true（指定事件为捕获模式，在捕获到后函数生效）;默认是false。</strong>结合DOM2的事件流机制可以更好理解。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">btn.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.loh(<span class="string">"click1"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);  <span class="comment">// this指向当前处理事件的元素，与event.currentTarget相同</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line">btn.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(click2);  <span class="comment">// 在上面click1和this输出后打印‘click2’</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="事件取消"><a href="#事件取消" class="headerlink" title="事件取消"></a>事件取消</h3><p>事件取消的方法都是在事件对象event上，有下面三种：</p>
<ul>
<li><strong>preventDefault()：</strong>阻止与事件关联的默认行为，如a标签的重定向与click事件关联。</li>
<li><strong>stopPropagation()：</strong>阻止捕获和冒泡阶段中当前事件的进一步传播。</li>
<li><strong>stopImmediatePropagation()：</strong>不但阻止事件传播，还会阻止在该处理函数后面注册的事件处理函数</li>
</ul>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>sf上看到一道事件流相关的题目，把它版过来，方便检验对事件流的理解，如下：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#a&#123;</span></span><br><span class="line"><span class="symbol">    width:</span> <span class="number">300</span>px;</span><br><span class="line"><span class="symbol">    height:</span> <span class="number">300</span>px;</span><br><span class="line"><span class="symbol">    background:</span> pink;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#b&#123;</span></span><br><span class="line"><span class="symbol">    width:</span> <span class="number">200</span>px;</span><br><span class="line"><span class="symbol">    height:</span> <span class="number">200</span>px;</span><br><span class="line"><span class="symbol">    background:</span> blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#c&#123;</span></span><br><span class="line"><span class="symbol">    width:</span> <span class="number">100</span>px;</span><br><span class="line"><span class="symbol">    height:</span> <span class="number">100</span>px;</span><br><span class="line"><span class="symbol">    background:</span> yellow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="params">&lt;div id="a"&gt;</span></span><br><span class="line">    <span class="params">&lt;div id="b"&gt;</span></span><br><span class="line">        <span class="params">&lt;div id="c"&gt;</span><span class="params">&lt;/div&gt;</span></span><br><span class="line">    <span class="params">&lt;/div&gt;</span></span><br><span class="line"><span class="params">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">document</span>.getElementById(<span class="string">"a"</span>),</span><br><span class="line">    b = <span class="built_in">document</span>.getElementById(<span class="string">"b"</span>),</span><br><span class="line">    c = <span class="built_in">document</span>.getElementById(<span class="string">"c"</span>);</span><br><span class="line">c.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"c1"</span>);</span><br><span class="line">    <span class="comment">// 注意第三个参数没有传进 false , 因为默认传进来的是 false</span></span><br><span class="line">    <span class="comment">//，代表冒泡阶段调用，个人认为处于目标阶段也会调用的</span></span><br><span class="line">&#125;);</span><br><span class="line">c.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"c2"</span>);</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line">b.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"b"</span>);</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line">a.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"a1"</span>);</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line">a.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"a2"</span>)</span><br><span class="line">&#125;);</span><br><span class="line">a.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"a3"</span>);</span><br><span class="line">    event.stopImmediatePropagation();</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line">a.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"a4"</span>);</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>页面结构如下<br><img src="https://coding.net/u/home-fyy/p/blog_images/git/raw/master/code_images/event_stream_test.png" width="200" height="200" title="test"></p>
<p>问题如下：</p>
<ul>
<li>如果点击c或者b，输出什么?（答案是a1、a3） </li>
<li>如果点击a，输出什么?（答案是 a1、a2、a3）</li>
</ul>
</div><div class="tags"><a href="/tags/js/">js</a></div><div class="post-nav"><a class="pre" href="/2019/02/03/js类和原型/">js类和原型</a><a class="next" href="/2019/01/26/ES6-Reflect对象/">ES6--Reflect对象</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://fyyhome.top"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/03/04/js那些剪不断，理还乱的继承/">js那些剪不断，理还乱的继承</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/28/理解事件循环机制-EventLoop/">理解事件循环机制---EventLoop</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/17/javascript的作用域和上下文/">javascript的作用域和上下文</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/03/js类和原型/">js类和原型</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/02/DOM事件---扫盲/">DOM事件---扫盲</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/26/ES6-Reflect对象/">ES6--Reflect对象</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/25/proxy笔记/">proxy笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/24/js之Set和Map结构/">js之Set和Map结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/23/js之属性名的遍历/">js之属性名的遍历</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/22/coding仓库搭博客图床/">coding仓库搭博客图床</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">kungfufu.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>