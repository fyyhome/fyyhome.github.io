---
title: 理解事件循环机制---EventLoop
date: 2019-02-28 12:41:19
tags: javascrpt, EventLoop
---

### 前言
javascript是一门单线程语言，处理很多耗时任务时如果只用一个线程就很容易发生阻塞，浏览器执行js时是怎么避免的呢？为什么js不设计成多线程语言呢？可能是因为js设计者最初的想法是让js简单，易用，也可能是因为要操作dom的原因，试想如果有2个线程并行，一个删除dom元素，一个修改同一dom元素，到底执行谁呢？ 感觉有点像数据库并发的脏读一样。为了加深对js执行时的理解，就有了下面的文章。

### 什么是事件循环
浏览器端获取到js代码后，会把变量存在堆里，对象指针存在栈里，然后一段一段运行执行栈里代码，遇到异步任务时，将任务挂起，继续执行后面的同步代码。挂起的异步任务在有了返回结果后会把返回结果（通常是回调函数）放入任务队列，任务队列有分为微任务队列和宏任务队列， 当执行栈中的任务都被执行完了，主进程空闲状态，它就会从微任务队列中把任务依次取到执行栈中执行，如果微任务队列为空，则从宏任务队列中取，执行栈执行完后为空，继续从任务队列取任务，如此循环。

网上引了一张图：
  {% img https://coding.net/u/home-fyy/p/blog_images/git/raw/master/code_images/eventloop.png %}

### 哪些是异步任务
js是单线程，但是浏览器是多线程的，它有不同的模块用于处理不同的异步任务，所以异步任务又可以细分三种

 - dom事件：当被监听的事件触发后，浏览器立即把回调函数加入宏任务队列。
 - setTimeout,setInterval: 到达指定时间点后把回调加入宏任务队列。
 - promise：resolve后把回调加入微任务队列。

前两者是属于宏任务队列，而es6中的promise是属于微任务队列。

### 通过代码理解事件循环
看到好的题目再贴

### 总结
要理解的东西

 - 事件循环机制
 - 执行栈与任务队列
 - 宏任务与微任务